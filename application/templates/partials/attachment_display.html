{% load static %}
{% load file_utils %}

<!-- Attachment Display Partial Template -->
<div class="attachment-item {% attachment_status_class attachment %}">
    <div class="text-center mb-2">
        {% if attachment.file_path|file_exists %}
            <!-- File exists - display normally -->
            {% if is_pdf %}
                <img src="{% static 'img/pdf-icon.svg' %}" alt="PDF Document" class="doc-icon-100">
            {% elif is_doc %}
                <img src="{% static 'img/word-icon.svg' %}" alt="Word Document" class="doc-icon-100">
            {% elif is_image %}
                <img src="{{ attachment.file_url }}" alt="{{ attachment.filename }}" 
                     class="img-thumbnail img-attachment-120"
                     onerror="this.src='{% static 'img/missing-image.svg' %}'; this.onerror=null;">
            {% else %}
                <img src="{% static 'img/file-icon.svg' %}" alt="File" class="doc-icon-100">
            {% endif %}
        {% else %}
            <!-- File missing - show placeholder -->
            <div class="missing-file-container text-center p-3 border border-danger rounded">
                {% if is_image %}
                    <img src="{% static 'img/missing-image.svg' %}" alt="Missing Image" class="doc-icon-100 opacity-50">
                {% elif is_pdf %}
                    <img src="{% static 'img/pdf-icon.svg' %}" alt="Missing PDF" class="doc-icon-100 opacity-50">
                {% elif is_doc %}
                    <img src="{% static 'img/word-icon.svg' %}" alt="Missing Document" class="doc-icon-100 opacity-50">
                {% else %}
                    <img src="{% static 'img/file-icon.svg' %}" alt="Missing File" class="doc-icon-100 opacity-50">
                {% endif %}
                <div class="text-danger small mt-2">
                    <i class="bi bi-exclamation-triangle"></i>
                    File not found
                </div>
            </div>
        {% endif %}
    </div>
    
    <div class="text-center">
        <div class="fw-bold small attachment-filename {% if missing_file %}text-muted{% endif %}" title="{{ attachment.filename }}">
            {{ attachment.filename }}
        </div>
        <div class="text-muted small">
            {{ attachment.file_size|filesizeformat }}
        </div>
        <div class="small">
            <span class="badge {% if file_exists %}bg-success{% else %}bg-danger{% endif %}">
                {% attachment_status_text attachment %}
            </span>
        </div>
    </div>
</div>
